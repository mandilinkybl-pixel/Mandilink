<%- include('common/header') %>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container-fluid">
           <div class="container mt-4">
  <h2>Job Listings</h2>
  <a href="/admin/create-job" class="btn btn-primary mb-3">+ Create Job</a>

  <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search jobs...">

<div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
  <table class="table table-bordered table-hover" id="jobsTable">
    <thead class="table-dark">
      <tr>
        <th>Title</th>
        <th>Company</th>
        <th>Location</th>
        <th>Salary</th>
        <th>Type</th>
        <th>Requirements</th>
        <th>Description</th>
        <th>Contact</th>
        <th>Email</th>
        <th>Posted By</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% jobs.forEach(job => { %>
        <tr>
          <td><%= job.title %></td>
          <td><%= job.companyName %></td>
          <td><%= job.location %></td>
          <td><%= job.salary || "N/A" %></td>
          <td><%= job.jobType %></td>
          <td>
            <% if (job.requirements && job.requirements.length > 0) { %>
              <ul class="mb-0">
                <% job.requirements.forEach(req => { %>
                  <li><%= req %></li>
                <% }) %>
              </ul>
            <% } else { %>
              N/A
            <% } %>
          </td>
          <td><%= job.description || "N/A" %></td>
          <td><%= job.contactNumber %></td>
          <td><%= job.contactEmail %></td>
          <td><%= job.postedBy ? job.postedBy.name : "Unknown" %></td>
          <td>
            <button 
              class="btn btn-sm btn-warning editBtn"
              data-id="<%= job._id %>"
              data-title="<%= job.title %>"
              data-company="<%= job.companyName %>"
              data-location="<%= job.location %>"
              data-salary="<%= job.salary || '' %>"
              data-type="<%= job.jobType %>"
              data-requirements="<%= job.requirements ? job.requirements.join(',') : '' %>"
              data-description="<%= job.description %>"
              data-contact="<%= job.contactNumber %>"
              data-email="<%= job.contactEmail %>"
              data-bs-toggle="modal"
              data-bs-target="#editJobModal"
            >
              Edit
            </button>
            <a href="/admin/jobs/delete/<%= job._id %>" onclick="return confirm('Are you sure?')" class="btn btn-sm btn-danger">Delete</a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>




</div>
   </div>
    </div>
<!-- Edit Job Modal -->
<!-- Edit Job Modal -->
<div class="modal fade" id="editJobModal" tabindex="-1" aria-hidden="true" style="padding-top: 50px;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="editJobForm" method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Edit Job</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="editJobId">

          <div class="mb-3">
            <label>Title</label>
            <input type="text" name="title" id="editTitle" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Company Name</label>
            <input type="text" name="companyName" id="editCompany" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Location</label>
            <input type="text" name="location" id="editLocation" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Salary</label>
            <input type="text" name="salary" id="editSalary" class="form-control">
          </div>

          <div class="mb-3">
            <label>Job Type</label>
            <select name="jobType" id="editType" class="form-control">
              <option value="Full-Time">Full-Time</option>
              <option value="Part-Time">Part-Time</option>
              <option value="Internship">Internship</option>
              <option value="Contract">Contract</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="editRequirements" class="form-label">Requirements</label>
            <textarea class="form-control" name="requirements" id="editRequirements" rows="3"></textarea>
            <small class="text-muted">Enter each requirement on a new line.</small>
          </div>

          <div class="mb-3">
            <label>Description</label>
            <textarea name="description" id="editDescription" class="form-control" rows="3"></textarea>
          </div>

          <div class="mb-3">
            <label>Contact Number</label>
            <input type="text" name="contactNumber" id="editContact" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Contact Email</label>
            <input type="email" name="contactEmail" id="editEmail" class="form-control" required>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Job</button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>
  // Search filter
  const searchInput = document.getElementById("searchInput");
  const rows = document.querySelectorAll("#jobsTable tbody tr");
  const footer = document.querySelector("#jobsTable tfoot");

  searchInput.addEventListener("keyup", function() {
    let value = this.value.toLowerCase();
    let matchCount = 0;

    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      if (text.includes(value)) {
        row.style.display = "";
        matchCount++;
      } else {
        row.style.display = "none";
      }
    });

    footer.style.display = matchCount === 0 ? "" : "none";
  });

  // Fill modal with job data
  document.querySelectorAll(".editBtn").forEach(btn => {
    btn.addEventListener("click", function() {
      document.getElementById("editJobId").value = this.dataset.id;
      document.getElementById("editTitle").value = this.dataset.title;
      document.getElementById("editCompany").value = this.dataset.company;
      document.getElementById("editLocation").value = this.dataset.location;
      document.getElementById("editSalary").value = this.dataset.salary;
      document.getElementById("editType").value = this.dataset.type;
     document.getElementById("editRequirements").value = this.dataset.requirements
      ? this.dataset.requirements.split(",").join("\n")
      : "";
      document.getElementById("editDescription").value = this.dataset.description;
      document.getElementById("editContact").value = this.dataset.contact;
      document.getElementById("editEmail").value = this.dataset.email;

      // Update form action dynamically
      document.getElementById("editJobForm").action = "/admin/jobs/update/" + this.dataset.id;
    });
  });
</script>
     

<%- include('common/footer') %>