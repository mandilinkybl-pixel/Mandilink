<%- include('common/header') %>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <div class="container-fluid" style="padding:20px;">
  <h2 class="mb-3">Employees</h2>
  <a href="/admin/create-employee" class="btn btn-success mb-3" style="margin-bottom:15px;">+ Add Employee</a>

  <!-- Search Bar -->
  <input type="text" id="employeeSearch" placeholder="Search employees..." 
         style="width: 100%; padding:10px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">

  <table id="employeeTable" class="table table-bordered table-striped" style="width:100%; border-collapse:collapse;">
    <thead class="table-dark" style="background:#343a40; color:white;">
      <tr>
        <th style="padding:10px;">Name</th>
        <th style="padding:10px;">Email</th>
        <th style="padding:10px;">Mobile</th>
        <th style="padding:10px;">Role</th>
        <th style="padding:10px;">Status</th>
        <th style="padding:10px;">Access</th>
        <th style="padding:10px;">Actions</th>
      </tr>
    </thead>
   <tbody id="employeeTableBody">
  <% employees.forEach(emp => { %>
    <tr>
      <td style="padding:10px;"><%= emp.name %></td>
      <td style="padding:10px;"><%= emp.email %></td>
      <td style="padding:10px;"><%= emp.mobile %></td>
      <td style="padding:10px;"><%= emp.role %></td>
      <td style="padding:10px;">
        <% if (emp.isBlocked) { %>
          <span style="background:#dc3545; color:white; padding:3px 8px; border-radius:5px;">Blocked</span>
        <% } else { %>
          <span style="background:#28a745; color:white; padding:3px 8px; border-radius:5px;">Active</span>
        <% } %>
      </td>
      <td style="padding:10px;">
        <% if (emp.access.length > 0) { %>
          <ul style="padding-left:15px; margin:0;">
            <% emp.access.forEach(acc => { %>
              <li><%= acc %></li>
            <% }) %>
          </ul>
        <% } else { %>
          <em>No Access</em>
        <% } %>
      </td>
      <td style="padding:10px;">
        <% if (emp.isBlocked) { %>
          <a href="/admin/employees/block-employee/<%= emp._id %>" 
             class="btn btn-sm btn-success" style="margin-bottom:5px;">Unblock</a>
        <% } else { %>
          <a href="/admin/employees/block-employee/<%= emp._id %>" 
             class="btn btn-sm btn-warning" style="margin-bottom:5px;">Block</a>
        <% } %>

        <a href="/admin/edit-employee/<%= emp._id %>" 
           class="btn btn-sm btn-primary" style="margin-bottom:5px;">Edit</a>

        <a href="/admin/employees/delete/<%= emp._id %>" 
           class="btn btn-sm btn-danger" 
           onclick="return confirm('Are you sure you want to delete this employee?')" 
           style="margin-bottom:5px;">Delete</a>
      </td>
    </tr>
  <% }) %>
</tbody>
</table>

<!-- Pagination Bar -->
<nav>
  <ul class="pagination" id="employeePagination"></ul>
</nav>

<script>
const pageSize = 15;
let currentPage = 1;

function getVisibleRows() {
  // Filtering for search
  const search = document.getElementById("employeeSearch").value.toLowerCase();
  const allRows = Array.from(document.querySelectorAll("#employeeTableBody tr"));
  if (!search) return allRows;
  return allRows.filter(row => row.innerText.toLowerCase().includes(search));
}

function showPage(page) {
  const rows = getVisibleRows();
  const totalPages = Math.ceil(rows.length / pageSize);
  currentPage = Math.max(1, Math.min(page, totalPages));

  // Hide all rows first
  rows.forEach(row => row.style.display = "none");
  // Show only the rows for the current page
  rows.slice((currentPage-1)*pageSize, currentPage*pageSize).forEach(row => row.style.display = "");

  // Render pagination links
  const pag = document.getElementById('employeePagination');
  if (totalPages <= 1) {
    pag.innerHTML = '';
    return;
  }
  let html = '';
  html += `<li class="page-item${currentPage === 1 ? ' disabled' : ''}">
      <a class="page-link" href="#" data-page="${currentPage-1}">&laquo;</a>
    </li>`;
  for(let i = 1; i <= totalPages; i++) {
    html += `<li class="page-item${i === currentPage ? ' active' : ''}">
        <a class="page-link" href="#" data-page="${i}">${i}</a>
      </li>`;
  }
  html += `<li class="page-item${currentPage === totalPages ? ' disabled' : ''}">
      <a class="page-link" href="#" data-page="${currentPage+1}">&raquo;</a>
    </li>`;
  pag.innerHTML = html;
  Array.from(pag.querySelectorAll('.page-link')).forEach(link => {
    link.onclick = function(e) {
      e.preventDefault();
      const page = parseInt(this.getAttribute('data-page'));
      if(!isNaN(page)) showPage(page);
    }
  });
}

document.getElementById("employeeSearch").addEventListener("keyup", function () {
  showPage(1);
});
document.addEventListener('DOMContentLoaded', function() {
  showPage(1);
});
</script>
  </table>
</div>

<!-- ðŸ”¹ Search Script -->
<script>
  document.getElementById("employeeSearch").addEventListener("keyup", function () {
    let input = this.value.toLowerCase();
    let rows = document.querySelectorAll("#employeeTable tbody tr");

    rows.forEach(row => {
      let text = row.innerText.toLowerCase();
      row.style.display = text.includes(input) ? "" : "none";
    });
  });
</script>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js Initialization -->
   <script>
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const sidebarToggle = document.getElementById('sidebarToggle');

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('collapsed');
        });
    </script>
</body>
</html>